<%
  # Set meta tags for individual external job page
  job_title = "#{job_offer.title} at #{job_offer.employer_company_name}"
  job_description = truncate(strip_tags(job_offer.description.to_s), length: 160)
  job_description = "#{job_title} in #{job_offer.region}. #{job_description}" if job_description.present?
  job_description = "#{job_title} - Apply now on DrillCrew job board." if job_description.blank?

  set_meta_tags(
    title: "#{job_title} - DrillCrew - external job preview",
    description: job_description,
    url: job_offer_url(job_offer),
    type: "article"
  )
%>

<div class="h-full bg-white overflow-y-auto">
  <div class="p-6">
    <!-- Header with close button -->
    <div class="flex justify-between items-start mb-6">
      <div class="flex-1">
        <!-- External job indicator -->
        <div class="flex items-center mb-2">
          <svg class="w-4 h-4 mr-1 text-orange-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM4.332 8.027a6.012 6.012 0 011.912-2.706C6.512 5.73 6.974 6 7.5 6A1.5 1.5 0 009 7.5V8a2 2 0 004 0 2 2 0 011.523-1.943A5.977 5.977 0 0116 10c0 .34-.028.675-.083 1H15a2 2 0 00-2 2v2.197A5.973 5.973 0 0110 16v-2a2 2 0 00-2-2 2 2 0 01-2-2 2 2 0 00-1.668-1.973z" clip-rule="evenodd"/>
          </svg>
          <span class="text-xs font-medium text-orange-600 bg-orange-50 px-2 py-1 rounded">External Offer</span>
        </div>

        <h1 class="text-2xl font-bold <%= job_offer.expired? ? 'text-gray-500' : 'text-orange-900' %> mb-2">
          <%= job_offer.title %>
          <% if job_offer.expired? %>
            <span class="text-sm text-red-500 block font-normal">(EXPIRED)</span>
          <% end %>
        </h1>
        <p class="text-lg <%= job_offer.expired? ? 'text-gray-400' : 'text-orange-700' %>"><%= job_offer.employer_company_name %></p>
      </div>
      <!-- Action buttons -->
      <div class="flex items-center space-x-2">
        <a href="<%= job_offer_url(job_offer) %>" target="_blank" rel="noopener noreferrer"
           class="group relative flex items-center justify-center h-10 w-10 bg-orange-600 hover:bg-orange-700 text-white rounded-full shadow transition-colors duration-300"
           aria-label="Open in a new tab">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M14 3h7m0 0v7m0-7L10 14m-4 0v7a2 2 0 002 2h8a2 2 0 002-2v-8a2 2 0 00-2-2h-7" />
          </svg>
          <span class="absolute left-1/2 -translate-x-1/2 top-full mt-2 px-2 py-1 rounded bg-gray-900 text-white text-xs opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-10 transition-opacity duration-200">Open in a new tab</span>
        </a>

        <!-- Copy URL Icon Button -->
        <button data-controller="copy-url"
                data-copy-url-url-value="<%= job_offer_url(job_offer) %>"
                data-action="click->copy-url#copy"
                data-copy-url-target="button"
                type="button"
                aria-label="Copy job offer URL"
                class="flex items-center justify-center h-10 w-10 bg-orange-600 hover:bg-orange-700 text-white rounded-full shadow transition-colors duration-300 group relative transition-opacity duration-200 cursor-pointer">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
          <span class="absolute left-1/2 -translate-x-1/2 top-full mt-2 px-2 py-1 rounded bg-gray-900 text-white text-xs opacity-0 group-hover:opacity-100 pointer-events-none whitespace-nowrap z-10">Copy the link</span>
        </button>

      </div>
    </div>

    <!-- Generic company logo placeholder for external jobs -->
    <div class="mb-6 flex justify-center">
      <div class="h-20 w-20 bg-orange-100 rounded-lg flex items-center justify-center #{'opacity-50' if job_offer.expired?}">
        <svg class="h-12 w-12 text-orange-600" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3a1 1 0 01-1-1v-2a1 1 0 00-1-1H9a1 1 0 00-1 1v2a1 1 0 01-1 1H4a1 1 0 110-2V4zm3 1h2v2H7V5zm2 4H7v2h2V9zm2-4h2v2h-2V5zm2 4h-2v2h2V9z" clip-rule="evenodd"/>
        </svg>
      </div>
    </div>

    <!-- Job meta information -->
    <div class="space-y-4 mb-6">
      <div class="<%= job_offer.expired? ? 'bg-gray-100' : 'bg-orange-50' %> p-4 rounded-lg">
        <p class="text-sm font-semibold <%= job_offer.expired? ? 'text-gray-600' : 'text-orange-800' %>">Region</p>
        <p class="text-sm <%= job_offer.expired? ? 'text-gray-500' : 'text-orange-700' %>"><%= job_offer_location(job_offer) %></p>
      </div>
      <div class="<%= job_offer.expired? ? 'bg-gray-100' : 'bg-orange-50' %> p-4 rounded-lg">
        <p class="text-sm font-semibold <%= job_offer.expired? ? 'text-gray-600' : 'text-orange-800' %>">Category</p>
        <p class="text-sm <%= job_offer.expired? ? 'text-gray-500' : 'text-orange-700' %>"><%= job_offer.category %></p>
      </div>
      <div class="<%= job_offer.expired? ? 'bg-gray-100' : 'bg-orange-50' %> p-4 rounded-lg">
        <p class="text-sm font-semibold <%= job_offer.expired? ? 'text-gray-600' : 'text-orange-800' %>">
          <%= job_offer.expired? ? 'Expired' : 'Posted' %>
        </p>
        <p class="text-sm <%= job_offer.expired? ? 'text-gray-500' : 'text-orange-700' %>">
          <%= if job_offer.expired?
                time_ago_in_words(job_offer.expired_on) + " ago"
              else
                time_ago_in_words(job_offer.created_at) + " ago"
              end %>
        </p>
      </div>
    </div>

    <!-- External Offer Disclaimer -->
    <div class="<%= job_offer.expired? ? 'bg-gray-100 border-gray-300' : 'bg-orange-50 border-orange-200' %> border rounded-lg p-4 mb-6">
      <div class="flex items-start">
        <div class="flex-shrink-0">
          <svg class="w-5 h-5 <%= job_offer.expired? ? 'text-gray-500' : 'text-orange-600' %> mt-0.5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-semibold <%= job_offer.expired? ? 'text-gray-700' : 'text-orange-800' %> mb-1">External Offer</h3>
          <p class="text-sm <%= job_offer.expired? ? 'text-gray-600' : 'text-orange-700' %>">
            This job offer was not posted by our customers. When you click "Apply to External Offer," you'll be redirected to the original job provider's website. This position was added to our platform to provide you with more opportunities, and no payment was received for its inclusion.
          </p>
        </div>
      </div>
    </div>

    <!-- Job Description -->
    <div class="prose prose-sm max-w-none <%= job_offer.expired? ? 'text-gray-600' : 'text-orange-800' %> mb-6">
      <h2 class="text-lg font-semibold <%= job_offer.expired? ? 'text-gray-700' : 'text-orange-900' %> mb-4">For whom is this job?</h2>
      <%= job_offer.description %>
    </div>

    <!-- Apply to External Offer Button -->
    <div class="border-t pt-6">
      <% if job_offer.expired? %>
        <button class="w-full bg-gray-400 text-gray-600 py-3 px-6 rounded-lg cursor-not-allowed" disabled>
          This offer has expired
        </button>
      <% else %>
        <a href="<%= apply_for_external_offer_job_offer_path(job_offer) %>"
           target="_blank"
           rel="noopener noreferrer"
           class="w-full bg-orange-600 text-white py-3 px-6 rounded-lg hover:bg-orange-700 transition-colors duration-300 inline-flex items-center justify-center">
          Apply to External Offer
          <svg class="w-4 h-4 ml-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
          </svg>
        </a>
      <% end %>
    </div>
  </div>
</div>
