<%
  # Set meta tags for individual job page
  job_title = "#{@job_offer.title} at #{@job_offer.company_name}"
  job_description = truncate(strip_tags(@job_offer.description), length: 160)
  job_description = "#{job_title} in #{@job_offer.region}. #{job_description}" if job_description.present?
  job_description = "#{job_title} - Apply now on DrillCrew job board." if job_description.blank?

  set_meta_tags(
    title: "#{job_title} - DrillCrew",
    description: job_description,
    url: job_offer_url(@job_offer),
    canonical: job_offer_url(@job_offer),
    type: "article",
    noindex: @job_offer.expired?
  )
%>

<% if @job_offer.is_a?(ExternalJobOffer) %>
  <%= render 'show_external_job', job_offer: @job_offer %>
<% else %>
  <%= render 'show_job', job_offer: @job_offer %>
<% end %>

<script>
    function handleBackClick(event) {
        event.preventDefault();
        const params = new URLSearchParams(window.location.search);
        if (params.has('success')) {
            return window.location.href = '/';
        }
        const { referrer } = document;
        if (referrer && new URL(referrer).origin === window.location.origin) {
            window.history.back();
        } else {
            window.location.href = '/';
        }
    }
</script>
