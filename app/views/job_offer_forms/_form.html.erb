<script>
    document.addEventListener("trix-file-accept", function(event) {
        event.preventDefault();
    });
</script>

<style>
    .trix-button-group--file-tools {
        display: none !important;
    }
</style>
<%= form_with(url: job_offer_forms_path, method: :post, model: job,  class: "space-y-6") do |f| %>
    <div class="bg-white rounded-lg shadow-xl p-12">
      <div class="space-y-6">
        <div>
          <%= f.label :title, "Job Title*", class: "block text-sm font-medium text-amber-900" %>
          <%= f.text_field :title, class: "mt-1 block w-full rounded-md border border-amber-300 shadow-sm focus:border-amber-500 focus:ring focus:ring-amber-500 focus:ring-opacity-50" %>          <%= error_messages_for(f, :title) %>
        </div>

        <div>
          <%= f.label :company_name, "Company Name*", class: "block text-sm font-medium text-amber-900" %>
          <% if current_employer %>
            <%= f.text_field :company_name, value: current_employer_company_name, class: "mt-1 block w-full rounded-md border border-amber-300 shadow-sm focus:border-amber-500 focus:ring focus:ring-amber-500 focus:ring-opacity-50" %>
          <% else %>
            <%= f.text_field :company_name, class: "mt-1 block w-full rounded-md border border-amber-300 shadow-sm focus:border-amber-500 focus:ring focus:ring-amber-500 focus:ring-opacity-50" %>
          <% end %>
          <%= error_messages_for(f, :company_name) %>
        </div>

        <div>
          <%= f.label :category, "Job Category*", class: "block text-sm font-medium text-amber-900" %>
          <% grouped_categories = JobOffer::CATEGORIES.overcategories_names.map { |overcat| [overcat, JobOffer::CATEGORIES.categories_for(overcat)] }.to_h %>
          <%= f.select :category, grouped_options_for_select(grouped_categories, f.object.category), { prompt: "Select category" },
                       class: "mt-1 block w-full rounded-md border border-amber-300 shadow-sm focus:border-amber-500 focus:ring focus:ring-amber-500 focus:ring-opacity-50" %>
          <%= error_messages_for(f, :category) %>
        </div>

        <% regions = {
          "Featured Regions" => JobOffer::HIGHLIGHTED_REGIONS,
          "Other Regions" => JobOffer::REGIONS
        } %>

<div class="mb-6"
     data-controller="searchable-select-simple"
     data-action="click@window->searchable-select-simple#hideOnBlur">

  <%= f.label :region, "Job Region*", class: "block text-sm font-medium text-amber-900" %>

  <%# This hidden field holds the selected value for the form submission %>
  <%= f.hidden_field :region, data: { "searchable-select-simple-target": "hiddenInput" } %>

  <div class="relative mt-1">
    <%# This is the visible input field the user types into %>
    <input type="text"
           data-searchable-select-simple-target="search"
           data-action="input->searchable-select-simple#filter click->searchable-select-simple#toggleOptions"
           placeholder="Search and select a region"
           class="pl-1 block w-full rounded-md border border-amber-300 shadow-sm focus:border-amber-500 focus:ring focus:ring-amber-500 focus:ring-opacity-50">

    <%# This container holds the list of searchable options. It's hidden by default. %>
    <div data-searchable-select-simple-target="optionsContainer"
         class="hidden absolute z-10 mt-1 w-full bg-white shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm">

      <%# Generate option groups directly from the regions hash %>
      <% regions.each do |group_label, options| %>
        <div data-searchable-select-simple-target="optionGroup">
          <h3 class="px-3 py-2 text-xs font-semibold text-gray-500"><%= group_label %></h3>
          <% options.each do |option_value| %>
            <div data-searchable-select-simple-target="option"
                 data-action="click->searchable-select-simple#selectOption"
                 data-value="<%= option_value %>"
                 class="text-amber-900 cursor-pointer select-none relative py-2 pl-3 pr-9 hover:bg-amber-100">
              <%= option_value %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <%= error_messages_for(f, :region) %>
</div>
        <div class="mb-6">
          <%= f.label :subregion, "Subregion", class: "block text-sm font-medium text-amber-900 mb-1" %>
          <%= f.text_field :subregion, placeholder: 'i.e. Texas, London or Jebel Fahud', class: "pl-1 mt-1 block w-full rounded-md border border-amber-300 shadow-sm focus:border-amber-500 focus:ring focus:ring-amber-500 focus:ring-opacity-50" %>
          <%= error_messages_for(f, :subregion) %>
        </div>


        <div class="mb-6"> <%# Add appropriate bottom margin %>
          <%= f.label :description, "Job Description*", class: "block text-sm font-medium text-amber-900 mb-1" %>

          <%# Pass a wrapper class - effects might be subtle, main styling is via CSS below %>
          <%= f.rich_text_area :description, class: "trix-custom-wrapper mt-1" %>

          <%# Style the error message area (adjust based on your helper's output HTML) %>
          <div class="mt-1 text-sm text-red-600" id="description_errors">
            <%= error_messages_for(f, :description) %>
          </div>
        </div>

        <% unless current_employer&.logo.present? %>
        <div data-controller="logo-preview">
          <%= f.label :logo, "Company Logo", class: "block text-sm font-medium text-amber-900" %>
          <%= image_tag "",
                        class: "w-32 h-32 rounded-md object-cover border mb-2 hidden",
                        data: { "logo-preview-target": "output" } %>
          <%= f.file_field :logo,
                           accept: 'image/*',
                           data: {
                             action: "change->logo-preview#show",
                             "logo-preview-target": "input"
                           },
                           class: "mt-1 block w-full text-sm text-amber-900
                      file:mr-4 file:py-2 file:px-4
                      file:rounded-full file:border-0
                      file:text-sm file:font-semibold
                      file:bg-amber-100 file:text-amber-700
                      hover:file:bg-amber-200" %>
          <%= error_messages_for(f, :logo) %>
          <p class="mt-2 text-sm text-amber-600">Upload a square image(max 1MB)</p>
        </div>
        <% end %>

        <% if current_employer %>
          <div>
            <%= f.label :email, "Contact Email*", class: "block text-sm font-medium text-amber-900" %>
            <%= f.email_field :email, value: current_employer.email, readonly: true, class: "mt-1 block w-full rounded-md border border-amber-300 shadow-sm focus:border-amber-500 focus:ring focus:ring-amber-500 focus:ring-opacity-50 bg-gray-100" %>
          </div>
        <% else %>
        <div>
          <%= f.label :email, "Contact Email*", class: "block text-sm font-medium text-amber-900" %>
          <%= f.email_field :email, class: "mt-1 block w-full rounded-md border border-amber-300 shadow-sm focus:border-amber-500 focus:ring focus:ring-amber-500 focus:ring-opacity-50" %>
          <%= error_messages_for(f, :email) %>
        </div>

        <div>
          <%= f.label :email_confirmation, "Confirm Email Address*", class: "block text-sm font-medium text-amber-900" %>
          <%= f.email_field :email_confirmation, class: "mt-1 block w-full rounded-md border border-amber-300 shadow-sm focus:border-amber-500 focus:ring focus:ring-amber-500 focus:ring-opacity-50" %>
          <%= error_messages_for(f, :email_confirmation) %>
        </div>

        <% end %>

        <%= render "application_type", f: f %>
      </div>

      <div id="voucher-temp">
        <%= render 'voucher', job: job %>
      </div>

      <div class="flex items-center space-x-2">
        <%= f.check_box :terms_and_conditions, class: "h-4 w-4 text-amber-800 border-gray-300 rounded focus:ring-amber-500" %>
        <%= f.label :terms_and_conditions, class: "text-sm font-medium text-amber-900" do %>
          I read and accept
          <%= link_to "terms and conditions", "/terms_and_conditions", target: "_blank", rel: "noopener", class: "underline text-amber-800 hover:text-amber-600" %>
        <% end %>
      </div>
      <div>
        <%= error_messages_for(f, :terms_and_conditions) %>
      </div>
      <%= turbo_frame_tag "submit" do %>
        <div class="mt-8">
          <%= f.submit "Post Job - Â£#{job.price}", class: "w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-amber-800 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500" %>
        </div>
      <% end %>


    </div>

  <% end %>
